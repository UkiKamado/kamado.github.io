<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tracking Link Generator</title>
<style>
  /* Import Poppins font from Google Fonts */
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap');

  :root {
    --color-primary: #111827;
    --color-secondary: #6b7280;
    --color-accent: #2563eb;
    --color-bg: #ffffff;
    --color-card-bg: #f9fafb;
    --border-radius: 0.75rem;
    --transition-speed: 0.3s;
  }

  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: var(--color-bg);
    color: var(--color-primary);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  header {
    position: sticky;
    top: 0;
    background: var(--color-bg);
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    z-index: 100;
  }

  nav {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .logo {
    font-weight: 700;
    font-size: 1.5rem;
    user-select: none;
  }

  nav a {
    color: var(--color-secondary);
    text-decoration: none;
    margin-left: 1.5rem;
    font-weight: 600;
    transition: color var(--transition-speed);
  }
  nav a:hover,
  nav a:focus {
    color: var(--color-accent);
    outline: none;
  }

  main {
    flex: 1 0 auto;
    max-width: 900px;
    margin: 3rem auto 4rem;
    padding: 0 1rem;
    width: 100%;
  }

  .hero {
    text-align: center;
    margin-bottom: 3rem;
  }
  .hero h1 {
    font-weight: 700;
    font-size: 3.5rem;
    max-width: 640px;
    margin: 0 auto 1rem;
    color: var(--color-primary);
  }
  .hero p {
    font-weight: 500;
    font-size: 1.25rem;
    color: var(--color-secondary);
    max-width: 560px;
    margin: 0 auto;
  }
  .btn-primary {
    margin-top: 2rem;
    background-color: var(--color-accent);
    color: white;
    font-weight: 600;
    border: none;
    border-radius: var(--border-radius);
    padding: 0.85rem 2.5rem;
    font-size: 1.125rem;
    cursor: pointer;
    transition: background-color var(--transition-speed), transform var(--transition-speed);
    user-select: none;
  }
  .btn-primary:hover,
  .btn-primary:focus {
    background-color: #1e40af;
    transform: scale(1.04);
    outline: none;
  }

  /* Card style */
  .card {
    background: var(--color-card-bg);
    border-radius: var(--border-radius);
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.05);
    padding: 1.75rem 2rem;
    margin-bottom: 2.5rem;
  }

  label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--color-primary);
  }

  input[type="text"] {
    width: 100%;
    padding: 0.6rem 1rem;
    font-size: 1rem;
    border-radius: var(--border-radius);
    border: 1.5px solid #d1d5db;
    transition: border-color var(--transition-speed);
    outline-offset: 2px;
  }
  input[type="text"]:focus {
    border-color: var(--color-accent);
    outline: none;
  }

  .link-output {
    background: #e0e7ff;
    padding: 0.75rem 1rem;
    border-radius: var(--border-radius);
    font-family: monospace;
    user-select: all;
    margin-top: 0.5rem;
    word-break: break-all;
    cursor: pointer;
    transition: background-color var(--transition-speed);
  }
  .link-output:hover {
    background-color: #c7d2fe;
  }

  .locations-list {
    max-height: 300px;
    overflow-y: auto;
    margin-top: 1rem;
    border: 1px solid #d1d5db;
    border-radius: var(--border-radius);
    background: white;
  }
  .locations-list table {
    width: 100%;
    border-collapse: collapse;
  }
  .locations-list th,
  .locations-list td {
    text-align: left;
    padding: 0.5rem 0.75rem;
    border-bottom: 1px solid #e5e7eb;
    font-size: 0.9rem;
    color: var(--color-primary);
  }
  .locations-list th {
    font-weight: 600;
    background: #f3f4f6;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  .notification {
    color: #059669;
    font-weight: 600;
    margin-top: 1rem;
  }

  footer {
    text-align: center;
    font-size: 0.875rem;
    padding: 2rem 1rem 3rem;
    color: var(--color-secondary);
    user-select: none;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .hero h1 {
      font-size: 2.25rem;
    }
    nav {
      padding: 1rem;
    }
  }
</style>
</head>
<body>
<header>
  <nav>
    <div class="logo" tabindex="0">TrackLink</div>
    <div>
      <a href="#create" tabindex="0">Create Link</a>
      <a href="#view" tabindex="0">View Locations</a>
    </div>
  </nav>
</header>
<main>
  <section id="home" class="hero" aria-label="Hero introduction">
    <h1>Generate Tracking Links and See Where Visitors Open Them</h1>
    <p>Create custom tracking URLs to capture the location of anyone who opens them. No backend needed â€” everything runs in your browser.</p>
    <button class="btn-primary" id="btnCreateLink" aria-controls="create" aria-label="Go to create link section">Create Tracking Link</button>
  </section>

  <section id="create" aria-label="Create Tracking Link" hidden>
    <div class="card">
      <h2>Create a Tracking Link</h2>
      <label for="linkName">Tracking Link Name (optional)</label>
      <input type="text" id="linkName" placeholder="E.g. Summer Promo" aria-describedby="linkNameHelp" />
      <small id="linkNameHelp" style="color:#6b7280;">Name helps identify your tracking link.</small>
      <button class="btn-primary" id="generateBtn" style="margin-top:1.5rem;" aria-live="polite">Generate Link</button>
      <div id="generatedLinkContainer" style="display:none;">
        <label for="generatedLink" style="margin-top:1.5rem;">Your Tracking Link:</label>
        <div id="generatedLink" class="link-output" role="textbox" tabindex="0" aria-readonly="true"></div>
        <div class="notification" id="copyMsg" style="display:none;">Link copied to clipboard!</div>
      </div>
    </div>
  </section>

  <section id="view" aria-label="View Collected Locations" hidden>
    <div class="card">
      <h2>Collected Locations</h2>
      <p id="noLocationsMsg">No tracking links or locations found yet.</p>
      <div id="locationsContainer" class="locations-list" tabindex="0" aria-live="polite" aria-relevant="additions"></div>
    </div>
  </section>

  <section id="track" aria-label="Tracking Visitor Location" hidden>
    <div class="card" style="text-align:center;">
      <h2>Tracking Your Location</h2>
      <p id="trackingStatus">Requesting permission to get your location...</p>
    </div>
  </section>
</main>
<footer>
  &copy; 2024 TrackLink. All rights reserved.
</footer>
<script>
(() => {
  // Utility to generate short random ID
  function generateId() {
    return Math.random().toString(36).substring(2, 10);
  }

  // Base url of this page without query params
  function baseUrl() {
    return window.location.origin + window.location.pathname;
  }

  // Storage key prefix
  const STORAGE_KEY = 'tracklink_data';

  // Current mode from URL hash or param
  function getCurrentMode() {
    const url = new URL(window.location.href);
    if (url.searchParams.has('track')) {
      return 'track';
    }
    if (window.location.hash === '#create') return 'create';
    if (window.location.hash === '#view') return 'view';
    return 'home';
  }

  // Save tracking data to localStorage
  function saveTrackingData(trackingId, locationData) {
    const raw = localStorage.getItem(STORAGE_KEY);
    let allData = raw ? JSON.parse(raw) : {};
    if (!allData[trackingId]) {
      allData[trackingId] = [];
    }
    allData[trackingId].push(locationData);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
  }

  // Get all tracking data
  function getAllTrackingData() {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : {};
  }

  // UI Elements
  const sections = {
    home: document.getElementById('home'),
    create: document.getElementById('create'),
    view: document.getElementById('view'),
    track: document.getElementById('track')
  };

  const linkNameInput = document.getElementById('linkName');
  const generateBtn = document.getElementById('generateBtn');
  const generatedLinkContainer = document.getElementById('generatedLinkContainer');
  const generatedLinkDisplay = document.getElementById('generatedLink');
  const copyMsg = document.getElementById('copyMsg');

  const noLocationsMsg = document.getElementById('noLocationsMsg');
  const locationsContainer = document.getElementById('locationsContainer');

  const trackingStatus = document.getElementById('trackingStatus');
  const btnCreateLink = document.getElementById('btnCreateLink');

  // Show only one section
  function showSection(name) {
    Object.keys(sections).forEach(key => {
      sections[key].hidden = key !== name;
    });
    if (name === 'view') {
      renderLocations();
    }
  }

  // Render the recorded locations for all tracking IDs
  function renderLocations() {
    const data = getAllTrackingData();
    locationsContainer.innerHTML = '';
    if (Object.keys(data).length === 0) {
      noLocationsMsg.style.display = 'block';
      locationsContainer.style.display = 'none';
      return;
    }
    noLocationsMsg.style.display = 'none';
    locationsContainer.style.display = 'block';

    // Create a table with all tracking data grouped by link name/id
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    ['Link Name / ID', 'Timestamp', 'Latitude', 'Longitude', 'Accuracy (m)'].forEach(h => {
      const th = document.createElement('th');
      th.textContent = h;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement('tbody');
    Object.entries(data).forEach(([trackingId, locations]) => {
      locations.forEach(loc => {
        const row = document.createElement('tr');
        // Link name or ID
        const nameCell = document.createElement('td');
        nameCell.textContent = loc.linkName || trackingId;
        row.appendChild(nameCell);
        // Timestamp
        const timeCell = document.createElement('td');
        timeCell.textContent = new Date(loc.timestamp).toLocaleString();
        row.appendChild(timeCell);
        // Latitude
        const latCell = document.createElement('td');
        latCell.textContent = loc.latitude.toFixed(5);
        row.appendChild(latCell);
        // Longitude
        const lonCell = document.createElement('td');
        lonCell.textContent = loc.longitude.toFixed(5);
        row.appendChild(lonCell);
        // Accuracy
        const accCell = document.createElement('td');
        accCell.textContent = loc.accuracy ? loc.accuracy.toFixed(1) : 'N/A';
        row.appendChild(accCell);

        tbody.appendChild(row);
      });
    });
    table.appendChild(tbody);
    locationsContainer.appendChild(table);
  }

  // Generate a unique ID and store link data (with optional name)
  function generateTrackingLink(name) {
    const linkId = generateId();
    // Store metadata for this link in localStorage
    const data = getAllTrackingData();
    if (!(linkId in data)) {
      data[linkId] = [];
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    // Store name in a separate cache for display when saving location
    localStorage.setItem('tracklink_name_' + linkId, name || '');
    return baseUrl() + '?track=' + linkId;
  }

  // Copy text to clipboard
  function copyToClipboard(text) {
    if (navigator.clipboard && window.isSecureContext) {
      return navigator.clipboard.writeText(text);
    } else {
      // fallback
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.top = -9999 + 'px';
      document.body.appendChild(textarea);
      textarea.focus();
      textarea.select();
      try {
        document.execCommand('copy');
      } catch {}
      document.body.removeChild(textarea);
      return Promise.resolve();
    }
  }

  // On generate button click
  generateBtn.addEventListener('click', () => {
    const name = linkNameInput.value.trim();
    const link = generateTrackingLink(name);
    generatedLinkDisplay.textContent = link;
    generatedLinkContainer.style.display = 'block';
    copyToClipboard(link).then(() => {
      copyMsg.style.display = 'block';
      setTimeout(() => {
        copyMsg.style.display = 'none';
      }, 1800);
    });

    // Clear input
    linkNameInput.value = '';
  });

  // Clicking on generated link copies it as well
  generatedLinkDisplay.addEventListener('click', () => {
    copyToClipboard(generatedLinkDisplay.textContent).then(() => {
      copyMsg.style.display = 'block';
      setTimeout(() => {
        copyMsg.style.display = 'none';
      }, 1800);
    });
  });

  btnCreateLink.addEventListener('click', () => {
    updateView('create');
  });

  // Tracking page logic
  function startTracking(trackingId) {
    showSection('track');
    trackingStatus.textContent = 'Requesting permission to get your location...';

    // Look up the link name if set
    const linkName = localStorage.getItem('tracklink_name_' + trackingId) || '';

    if (!navigator.geolocation) {
      trackingStatus.textContent = 'Geolocation is not supported by your browser.';
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (position) => {
        const coords = position.coords;
        trackingStatus.textContent = 'Location acquired. Thank you!';
        // Save location data to localStorage
        saveTrackingData(trackingId, {
          latitude: coords.latitude,
          longitude: coords.longitude,
          accuracy: coords.accuracy,
          timestamp: position.timestamp,
          linkName
        });

        // Optionally show a short thank you or redirect after a delay
        setTimeout(() => {
          trackingStatus.textContent += ' You may close this tab.';
        }, 1500);
      },
      (error) => {
        switch(error.code) {
          case error.PERMISSION_DENIED:
            trackingStatus.textContent = 'Permission denied. Unable to get location.';
            break;
          case error.POSITION_UNAVAILABLE:
            trackingStatus.textContent = 'Location information is unavailable.';
            break;
          case error.TIMEOUT:
            trackingStatus.textContent = 'The request to get your location timed out.';
            break;
          default:
            trackingStatus.textContent = 'An unknown error occurred.';
            break;
        }
      },
      {timeout: 15000, maximumAge: 60000}
    );
  }

  // Routing and show sections
  function updateView(mode) {
    switch(mode) {
      case 'track':
        const url = new URL(window.location.href);
        const trackingId = url.searchParams.get('track');
        if (trackingId) {
          startTracking(trackingId);
          return;
        }
        break;
      case 'create': showSection('create'); break;
      case 'view': showSection('view'); break;
      default: showSection('home'); break;
    }
  }

  // Initialize
  function init() {
    const mode = getCurrentMode();
    updateView(mode);

    // Navigation links
    document.querySelectorAll('nav a').forEach(a => {
      a.addEventListener('click', (e) => {
        e.preventDefault();
        const target = a.getAttribute('href').substring(1);
        history.pushState(null, '', '#' + target);
        updateView(target);
      });
    });

    // Handle popstate for back/forward navigation
    window.addEventListener('popstate', () => {
      const mode = getCurrentMode();
      updateView(mode);
    });
  }

  document.addEventListener('DOMContentLoaded', init);
})();
</script>
</body>
</html>

